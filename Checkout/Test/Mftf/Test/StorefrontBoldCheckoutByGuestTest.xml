<?xml version="1.0" encoding="UTF-8"?>
<tests xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:noNamespaceSchemaLocation="urn:magento:mftf:Test/etc/testSchema.xsd">
    <test name="StorefrontBoldCheckoutByGuestTest">
        <annotations>
            <features value="Bold Checkout"/>
            <stories value="Checkout as Guest"/>
            <title value="Checking placing order by Guest via Bold Checkout"/>
            <description value="Guest should be able to place an order via Bold Checkout"/>
            <severity value="MAJOR"/>
            <group value="bold_checkout"/>
        </annotations>
        <before>
            <!-- Create entities -->
            <createData entity="ApiCategory" stepKey="createCategory"/>
            <createData entity="ApiSimpleProduct" stepKey="createProduct">
                <requiredEntity createDataKey="createCategory"/>
            </createData>
            <!-- Run entities sync -->
<!--            <actionGroup ref="CliConsumerStartActionGroup" stepKey="syncCategories">-->
<!--                <argument name="consumerName" value="{{BoldCheckoutSyncCategoriesConsumerData.consumerName}}"/>-->
<!--                <argument name="maxMessages" value="{{BoldCheckoutSyncCategoriesConsumerData.messageLimit}}"/>-->
<!--            </actionGroup>-->
<!--            <actionGroup ref="CliConsumerStartActionGroup" stepKey="syncProducts">-->
<!--                <argument name="consumerName" value="{{BoldCheckoutSyncProductsConsumerData.consumerName}}"/>-->
<!--                <argument name="maxMessages" value="{{BoldCheckoutSyncProductsConsumerData.messageLimit}}"/>-->
<!--            </actionGroup>-->
<!--            <magentoCLI command="queue:consumers:start {{BoldCheckoutSyncCategoriesConsumerData.consumerName}}" timeout="10" stepKey="syncCategories"/>-->
<!--            <magentoCLI command="queue:consumers:start {{BoldCheckoutSyncProductsConsumerData.consumerName}}" timeout="10" stepKey="syncProducts"/>-->
        </before>
        <after>
            <!-- Delete entities -->
            <deleteData createDataKey="createProduct" stepKey="deleteProduct"/>
            <deleteData createDataKey="createCategory" stepKey="deleteCategory"/>
        </after>

        <!-- Go to Product page -->
        <actionGroup ref="StorefrontOpenProductPageActionGroup" stepKey="openProductPage">
<!--            <argument name="productUrl" value="$createProduct.custom_attributes[url_key]$"/>-->
            <argument name="productUrl" value="test-product"/>
        </actionGroup>

        <!-- Add Product to shopping cart -->
<!--        <actionGroup ref="AddToCartFromStorefrontProductPageActionGroup" stepKey="addProductToCart">-->
<!--            <argument name="productName" value="$createProduct.name$"/>-->
<!--        </actionGroup>-->
        <click selector="{{StorefrontProductActionSection.addToCart}}" stepKey="addProductToCart"/>
        <waitForElementVisible selector="{{StorefrontMessagesSection.success}}" stepKey="waitForProductAddedSuccessMessage"/>

        <!-- Go to Shopping cart page -->
        <actionGroup ref="StorefrontCartPageOpenActionGroup" stepKey="openShoppingCartPage"/>

        <!-- Go to Bold Checkout page -->
        <click selector="{{StorefrontCheckoutCartSummarySection.proceedToCheckout}}" stepKey="proceedToCheckout"/>
        <waitForElementVisible selector="{{StorefrontBoldCheckoutSection.checkoutExperienceContainer}}" stepKey="waitForCheckoutExperienceContainerVisible"/>
        <seeInCurrentUrl url="{{StorefrontBoldCheckoutPage.url(_ENV.SHOP_DOMAIN, 'resume')}}" stepKey="assertBoldCheckoutResumePageUrl"/>
    </test>
</tests>
